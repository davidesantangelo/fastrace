<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fastrace - Fast, Dependency-Free Traceroute</title>
    <link rel="stylesheet" href="css/styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css"
    />
  </head>

  <body>
    <header>
      <div class="container">
        <div class="logo">
          <i class="fas fa-network-wired"></i>
          <h1>fastrace</h1>
        </div>
        <nav>
          <a href="#overview">Overview</a>
          <a href="#architecture">Architecture</a>
          <a href="#performance">Performance</a>
          <a href="#usage">Usage</a>
          <a href="#technical">Technical</a>
          <a
            href="https://github.com/davidesantangelo/fastrace"
            target="_blank"
            class="github-link"
          >
            <i class="fab fa-github"></i> GitHub
          </a>
        </nav>
      </div>
    </header>

    <section class="hero">
      <div class="container">
        <div class="hero-content">
          <div class="version-badge">v0.4.1</div>
          <h2>Fast, dependency-free traceroute in pure C</h2>
          <p>
            Non-blocking sockets • TTL batching • Adaptive waits • Async DNS •
            Tunable pacing
          </p>
          <div class="buttons">
            <a href="#usage" class="button primary">Get Started</a>
            <a
              href="https://github.com/davidesantangelo/fastrace"
              class="button secondary"
              target="_blank"
              >View on GitHub</a
            >
          </div>
        </div>
        <div class="hero-image">
          <div class="terminal">
            <div class="terminal-header">
              <span class="dot red"></span>
              <span class="dot yellow"></span>
              <span class="dot green"></span>
              <span class="terminal-title">Terminal</span>
            </div>
            <div class="terminal-content">
              <pre><code>$ sudo ./fastrace google.com
fastrace 0.4.1
Tracing route to google.com (142.250.180.174)
Maximum hops: 30, Probes per hop: 3, Protocol: UDP
TTL │ IP Address         (RTT ms)    Hostname
────┼───────────────────────────────────────────
1   │ → 192.168.1.1     (  6.15 ms)
2   │ * * * (timeout)
3   │ * * * (timeout)
4   │ → 185.89.159.5    ( 14.77 ms)
5   │ → 37.26.80.129    ( 14.68 ms)
6   │ → 193.77.91.225   ( 29.88 ms) bsn-77-91-225.static.siol.net
7   │ → 193.77.107.46   ( 31.69 ms) bsn-77-107-46.static.siol.net

Trace complete. Hops: 13, Responses: 29/39 (74.4%)</code></pre>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="overview" class="overview">
      <div class="container">
        <h2>Overview</h2>
        <p>
          Fastrace is a blazingly fast traceroute utility designed for network
          diagnostics and performance analysis. It maps the route that packets
          take across an IP network from source to destination, providing
          detailed timing information and identifying potential bottlenecks or
          routing issues.
        </p>

        <div class="feature-grid">
          <div class="feature-card">
            <i class="fas fa-bolt"></i>
            <h3>Zero Dependencies</h3>
            <p>Pure C: libc + raw sockets, nothing else</p>
          </div>
          <div class="feature-card">
            <i class="fas fa-layer-group"></i>
            <h3>TTL Batching</h3>
            <p>
              Sets TTL once per hop and sends probes in bursts to cut syscalls
            </p>
          </div>
          <div class="feature-card">
            <i class="fas fa-stopwatch"></i>
            <h3>Adaptive Waits</h3>
            <p>
              Poll timing aligns to the next hop deadline to reduce idle spins
            </p>
          </div>
          <div class="feature-card">
            <i class="fas fa-tachometer-alt"></i>
            <h3>Non-Blocking Core</h3>
            <p>Event-driven pipeline with monotonic timing for stable RTTs</p>
          </div>
          <div class="feature-card">
            <i class="fas fa-sliders-h"></i>
            <h3>Tunable Pacing</h3>
            <p>
              Inter-probe delay flag (<code>-d</code>) to balance burstiness and
              jitter
            </p>
          </div>
          <div class="feature-card">
            <i class="fas fa-project-diagram"></i>
            <h3>Clear Output</h3>
            <p>Tree-style hops show load-balanced branches and precise RTTs</p>
          </div>
          <div class="feature-card">
            <i class="fas fa-server"></i>
            <h3>Async DNS</h3>
            <p>
              Dedicated thread for reverse lookups keeps the probe loop
              unblocked
            </p>
          </div>
          <div class="feature-card">
            <i class="fas fa-shield-alt"></i>
            <h3>Hardened Parsing</h3>
            <p>Bounds-checked ICMP handling and strict resource cleanup</p>
          </div>
          <div class="feature-card">
            <i class="fas fa-feather"></i>
            <h3>Lightweight</h3>
            <p>Compact data structures sized to your trace configuration</p>
          </div>
        </div>
      </div>
    </section>

    <section id="architecture" class="architecture">
      <div class="container">
        <h2>Technical Architecture</h2>

        <div class="tabs">
          <button class="tab-btn active" data-tab="dual-socket">
            Dual Socket Architecture
          </button>
          <button class="tab-btn" data-tab="probe">Probe Structure</button>
          <button class="tab-btn" data-tab="concurrent">
            Concurrent Discovery
          </button>
          <button class="tab-btn" data-tab="response">
            Response Processing
          </button>
          <button class="tab-btn" data-tab="async-dns">Async DNS</button>
          <button class="tab-btn" data-tab="visualization">
            Path Visualization
          </button>
        </div>

        <div class="tab-content active" id="dual-socket">
          <h3>Dual Socket Architecture</h3>
          <p>Fastrace uses two socket types for maximum effectiveness:</p>
          <ul>
            <li>
              UDP socket (<code>SOCK_DGRAM</code>) for sending probe packets
            </li>
            <li>
              Raw ICMP socket (<code>SOCK_RAW</code>) for receiving router
              responses
            </li>
          </ul>
          <pre><code class="language-c">send_sock = socket(AF_INET, SOCK_DGRAM, IPPROTO_UDP);
recv_sock = socket(AF_INET, SOCK_RAW, IPPROTO_ICMP);</code></pre>
        </div>

        <div class="tab-content" id="probe">
          <h3>Probe Structure</h3>
          <p>
            Each probe is tracked using a specialized structure with monotonic
            timing:
          </p>
          <pre><code class="language-c">typedef struct {
    int ttl;                  /* Time-to-Live value */
    int probe;                /* Probe sequence number */
    struct timespec sent_time; /* Monotonic timestamp when sent */
    bool received;            /* Whether response was received */
    struct in_addr addr;      /* Address of responding hop */
    double rtt;               /* Round-trip time in ms */
    int port;                 /* UDP port used for this probe */
} probe_t;</code></pre>
        </div>

        <div class="tab-content" id="concurrent">
          <h3>Adaptive Route Discovery</h3>
          <p>
            Fastrace implements a configurable multi-TTL probing system with
            runtime-adjustable concurrency:
          </p>
          <pre><code class="language-c">// Default concurrency window (tunable via -c flag)
config.max_active_ttls = 6;

// Probes per hop (tunable via -q flag)
config.num_probes = 3;

// Inter-probe delay in microseconds (tunable via -d flag)
config.probe_delay_us = 250;</code></pre>
          <p>
            Multiple TTLs stay in flight at once. Probes for a hop are batched
            under a single TTL setsockopt, cutting syscall overhead. Tuning
            <code>-c</code>, <code>-q</code>, and <code>-d</code> lets you
            balance speed and jitter.
          </p>
        </div>

        <div class="tab-content" id="response">
          <h3>Efficient Response Processing</h3>
          <p>
            The response processor uses a <code>poll()</code>-driven loop with
            non-blocking sockets to drain ICMP bursts. Time is monotonic
            throughout for stable RTT math:
          </p>
          <pre><code class="language-c">int process_responses(int timeout_ms) {
    struct pollfd pfd = { .fd = recv_sock, .events = POLLIN | POLLERR | POLLHUP };
    if (timeout_ms > 0 && poll(&pfd, 1, timeout_ms) <= 0) return 0;
    return drain_icmp_socket();
}

static double timespec_diff_ms(const struct timespec *start, const struct timespec *end) {
    time_t sec = end->tv_sec - start->tv_sec;
    long nsec = end->tv_nsec - start->tv_nsec;
    if (nsec < 0) { sec -= 1; nsec += 1000000000L; }
    return (double)sec * 1000.0 + (double)nsec / 1000000.0;
}</code></pre>
        </div>

        <div class="tab-content" id="async-dns">
          <h3>Asynchronous DNS Resolution</h3>
          <p>
            Hostname lookups are offloaded to a dedicated background thread to
            prevent blocking the main packet loop:
          </p>
          <pre><code class="language-c">static void *dns_worker(void *arg) {
    while (dns_running) {
        // ... wait for queue item ...
        if (getnameinfo(...) == 0) {
            host_cache_store(item->addr, host);
        }
    }
    return NULL;
}</code></pre>
        </div>

        <div class="tab-content" id="visualization">
          <h3>Visual Path Representation</h3>
          <p>
            Fastrace provides a structured visual representation of network
            paths:
          </p>
          <ul>
            <li>Tree-like format shows branching at load-balanced routes</li>
            <li>Clear arrows indicate path progression</li>
            <li>Distinct formatting for primary and alternative routes</li>
          </ul>
          <div class="visual-example">
            <pre>
7   │→ 72.14.209.224    ( 60.76 ms)
      └→ 72.14.223.184   ( 61.65 ms)
8   │→ 142.251.244.109  ( 59.57 ms)
      └→ 216.239.62.49   ( 71.36 ms)
      └→ 142.250.210.95  ( 70.25 ms)</pre
            >
          </div>
        </div>
      </div>
    </section>

    <section id="performance" class="performance">
      <div class="container">
        <h2>Performance at a Glance</h2>
        <p>
          Designed to stay fast and responsive under load: batched TTL sends,
          adaptive waits, non-blocking sockets, and async DNS.
        </p>

        <!-- Benchmark Comparison -->
        <div
          class="benchmark-comparison"
          style="
            margin: 2rem 0;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
          "
        >
          <h3 style="text-align: center; margin-bottom: 1.5rem">
            <i class="fas fa-tachometer-alt" style="color: #00ff88"></i>
            Benchmark: fastrace vs traceroute
          </h3>
          <div
            style="
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
              gap: 1.5rem;
            "
          >
            <div
              style="
                background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
                padding: 1.5rem;
                border-radius: 10px;
                text-align: center;
                color: #000;
              "
            >
              <h4 style="font-size: 1rem; margin-bottom: 0.5rem; opacity: 0.8">
                FASTRACE
              </h4>
              <div style="font-size: 2.5rem; font-weight: bold">~2s</div>
              <div style="font-size: 0.9rem; margin-top: 0.5rem">
                13 hops • 74.4% response rate
              </div>
            </div>
            <div
              style="
                background: rgba(255, 255, 255, 0.1);
                padding: 1.5rem;
                border-radius: 10px;
                text-align: center;
              "
            >
              <h4 style="font-size: 1rem; margin-bottom: 0.5rem; opacity: 0.6">
                TRACEROUTE
              </h4>
              <div style="font-size: 2.5rem; font-weight: bold; opacity: 0.7">
                ~30s
              </div>
              <div style="font-size: 0.9rem; margin-top: 0.5rem; opacity: 0.6">
                11 hops • sequential probing
              </div>
            </div>
          </div>
          <p
            style="
              text-align: center;
              margin-top: 1.5rem;
              font-size: 1.2rem;
              color: #00ff88;
            "
          >
            <strong>~15x faster</strong> with richer output including
            load-balanced path detection
          </p>
        </div>

        <div class="feature-grid" style="margin-top: 2rem">
          <div class="feature-card">
            <i class="fas fa-rocket"></i>
            <h3>Faster Routes</h3>
            <p>
              Multiple TTLs in flight plus batched probes cut total trace time.
            </p>
          </div>
          <div class="feature-card">
            <i class="fas fa-microchip"></i>
            <h3>Lower Overhead</h3>
            <p>
              Fewer syscalls per hop and tight data structures reduce CPU and
              memory use.
            </p>
          </div>
          <div class="feature-card">
            <i class="fas fa-wave-square"></i>
            <h3>Steady Timing</h3>
            <p>
              Monotonic clock for RTTs avoids drift from wall-clock adjustments.
            </p>
          </div>
          <div class="feature-card">
            <i class="fas fa-route"></i>
            <h3>Clear Output</h3>
            <p>
              Tree-style rendering highlights branching paths and per-hop RTTs.
            </p>
          </div>
        </div>
      </div>
    </section>

    <section id="usage" class="usage">
      <div class="container">
        <h2>Usage</h2>

        <!-- Makefile card - full width on top -->
        <div class="makefile-section">
          <div class="usage-card full-width">
            <h3>Using Makefile</h3>
            <p>
              The project includes a Makefile for easy compilation and
              installation:
            </p>
            <pre><code class="language-bash"># Standard optimized build
make

# Build with debugging symbols
make debug

# Build with maximum performance optimizations
make optimized

# Install to system (default: /usr/local/bin)
sudo make install

# Uninstall from system
sudo make uninstall

# Clean build artifacts
make clean</code></pre>
          </div>
        </div>

        <!-- CLI Options card - full width -->
        <div class="usage-card full-width">
          <h3>Command-Line Options</h3>
          <pre><code class="language-bash"># Disable DNS lookups for faster output
sudo ./fastrace -n google.com

# Set maximum hops and probes per hop
sudo ./fastrace -m 20 -q 5 google.com

# Adjust concurrent TTL window, pacing, and timeouts
sudo ./fastrace -c 8 -d 250 -W 2 -t 700 google.com

# Use custom base port
sudo ./fastrace -P 40000 google.com

# Show version
./fastrace -V</code></pre>
          <table style="margin-top: 1rem; width: 100%">
            <thead>
              <tr>
                <th>Option</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>-n</code></td>
                <td>Disable reverse DNS lookups</td>
              </tr>
              <tr>
                <td><code>-m &lt;hops&gt;</code></td>
                <td>Maximum hop count (1-128, default 30)</td>
              </tr>
              <tr>
                <td><code>-q &lt;probes&gt;</code></td>
                <td>Probes per hop (1-10, default 3)</td>
              </tr>
              <tr>
                <td><code>-c &lt;count&gt;</code></td>
                <td>Concurrent TTL window size (default 6)</td>
              </tr>
              <tr>
                <td><code>-W &lt;ms&gt;</code></td>
                <td>Poll wait timeout in milliseconds (default 2)</td>
              </tr>
              <tr>
                <td><code>-t &lt;ms&gt;</code></td>
                <td>Hop completion timeout in milliseconds (default 700)</td>
              </tr>
              <tr>
                <td><code>-d &lt;us&gt;</code></td>
                <td>Inter-probe delay in microseconds (default 250)</td>
              </tr>
              <tr>
                <td><code>-P &lt;port&gt;</code></td>
                <td>Base UDP destination port (default 33434)</td>
              </tr>
              <tr>
                <td><code>-V</code></td>
                <td>Print version information</td>
              </tr>
              <tr>
                <td><code>-h</code></td>
                <td>Display help message</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Manual Compilation and Basic Usage cards - side by side below -->
        <div class="usage-grid two-column">
          <div class="usage-card">
            <h3>Manual Compilation</h3>
            <pre><code class="language-bash">gcc -O3 -pthread -o fastrace fastrace.c</code></pre>
            <p>For maximum performance:</p>
            <pre><code class="language-bash">gcc -O3 -march=native -mtune=native -flto -pthread -o fastrace fastrace.c</code></pre>
          </div>
          <div class="usage-card">
            <h3>Basic Usage</h3>
            <pre><code class="language-bash">sudo ./fastrace &lt;target&gt;</code></pre>
            <p>Example:</p>
            <pre><code class="language-bash">sudo ./fastrace google.com</code></pre>
          </div>
        </div>
      </div>
    </section>

    <section id="technical" class="technical">
      <div class="container">
        <h2>Technical Requirements</h2>

        <div class="requirements-grid">
          <div class="requirements-card">
            <h3>System Requirements</h3>
            <ul>
              <li>
                <strong>Operating System:</strong> Linux, macOS, or other
                Unix-like systems with raw socket support
              </li>
              <li>
                <strong>Permissions:</strong> Root/sudo access required (raw
                sockets)
              </li>
              <li><strong>Compiler:</strong> GCC with C99 support or later</li>
              <li>
                <strong>Architecture:</strong> x86, x86_64, ARM, or any platform
                with standard C library support
              </li>
            </ul>
          </div>
          <div class="requirements-card">
            <h3>Header Dependencies</h3>
            <pre><code class="language-c">#include &lt;arpa/inet.h&gt;
#include &lt;errno.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;netdb.h&gt;
#include &lt;netinet/in.h&gt;
#include &lt;netinet/ip.h&gt;
#include &lt;netinet/ip_icmp.h&gt;
#include &lt;netinet/udp.h&gt;
#include &lt;poll.h&gt;
#include &lt;stdbool.h&gt;
#include &lt;stdint.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;sys/time.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;time.h&gt;
#include &lt;unistd.h&gt;
#include &lt;pthread.h&gt;
#include &lt;signal.h&gt;</code></pre>
          </div>
        </div>
      </div>
    </section>

    <footer>
      <div class="container">
        <div class="footer-content">
          <div class="copyright">
            <p>Copyright © 2025 Davide Santangelo</p>
          </div>
          <div class="links">
            <a href="https://github.com/davidesantangelo" target="_blank">
              <i class="fab fa-github"></i> GitHub
            </a>
            <a
              href="https://github.com/davidesantangelo/fastrace/blob/main/LICENSE"
              target="_blank"
            >
              <i class="fas fa-balance-scale"></i> License
            </a>
          </div>
        </div>
      </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Syntax highlighting
        hljs.highlightAll();

        // Tab functionality
        const tabButtons = document.querySelectorAll(".tab-btn");
        tabButtons.forEach((button) => {
          button.addEventListener("click", () => {
            // Remove active class from all buttons and content
            tabButtons.forEach((b) => b.classList.remove("active"));
            document
              .querySelectorAll(".tab-content")
              .forEach((c) => c.classList.remove("active"));

            // Add active class to current button and content
            button.classList.add("active");
            document.getElementById(button.dataset.tab).classList.add("active");
          });
        });

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
          anchor.addEventListener("click", function (e) {
            e.preventDefault();

            document.querySelector(this.getAttribute("href")).scrollIntoView({
              behavior: "smooth",
            });
          });
        });
      });
    </script>
  </body>
</html>
